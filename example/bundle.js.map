{"version":3,"file":"bundle.js","sources":["../src/Dep.js","../src/Observer.js","index.js"],"sourcesContent":["// import Dep from './Dep'\n\nclass Dep {\n  constructor() {\n    this.subscribers = []\n  }\n  depend(target) {\n    if (target && !this.subscribers.includes(target)) {\n      this.subscribers.push(target)\n    }\n  }\n  notify(data) {\n    this.subscribers.forEach(callback => {\n      callback(data)\n    })\n  }\n}\n\nexport default Dep","import Dep from './Dep'\n\nclass Observer {\n  constructor(data) {\n    this.target = null\n    let self = this\n\n    // 用于存放所有 Dep 实例的 Map\n    let deps = new Map()\n\n    // Proxy handler, 暂时无用, 后续可用于复杂数据的深度遍历\n    let handler = {\n      get(obj, key, receiver) {\n        if (typeof obj[key] === 'object' && obj[key] !== null) {\n          return new Proxy(obj[key], handler)\n        }\n        // 当获取的时候\n        deps.get(key).depend(self.target)\n        return Reflect.get(obj, key, receiver)\n      },\n      set(obj, key, newValue, receiver) {\n        obj[key] = newValue\n        deps.get(key).notify(obj)\n        return Reflect.set(obj, key, newValue, receiver)\n      }\n    }\n\n    // 给数据的每个 key 都生成一个 Dep 实例, 用于收集他们的操作\n    Object.keys(data).forEach(key => {\n      deps.set(key, new Dep())\n    })\n\n    this.data = new Proxy(data, {\n      get(obj, key) {\n        // 当有操作获取该数据时, 将该操作注入到该 key 的 Dep 中\n        deps.get(key).depend(self.target)\n\n        return obj[key]\n      },\n      set(obj, key, newValue) {\n        // 将数据更新\n        obj[key] = newValue\n\n        // 通知 get 时传入的响应事件, 并传入新数据\n        deps.get(key).notify(obj)\n        return true\n      }\n    })\n  }\n  event(func) {\n    this.target = func\n    this.target(this.data)\n    this.target = null\n  }\n}\n\nexport default Observer","import Observer from '../src/index'\n\nlet data = { name: 'sam', age: 18, BWH: [1, 2, 3] }\nlet observer = new Observer(data)\nobserver.event(function (data) {\n  let info = `${data.name} is ${data.age}`\n  console.log(info)\n})\nobserver.event(function (data) {\n  console.log('age ' + data.age)\n  console.log('BWH ' + data.BWH)\n})\n\ndocument.querySelector('#button').addEventListener('click', function () {\n  observer.data.age += 1\n  observer.data.BWH[0] = Math.random()\n})"],"names":[],"mappings":"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"}